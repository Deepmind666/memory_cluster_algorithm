# 03 技术方案：系统与流程

## 一、系统结构
系统包括：
1. 碎片采集模块：接收多 Agent 写入事件并标准化。
2. 向量化模块：将碎片内容映射为语义向量。
3. 增量聚类模块：按阈值将碎片归入已有簇或新建簇。
4. 压缩模块：执行簇内去重、共识抽取、冲突标记与摘要生成。
5. 偏好策略模块：根据类别/来源/时效控制保留强度。
6. 存储索引模块：保存簇摘要与 backrefs 反查索引。
7. 检索注入模块：按查询返回簇摘要并按需展开原始证据。

## 二、流程步骤
- S1：接收待写入碎片，提取元数据与来源信息。
- S2：计算碎片语义向量并执行候选簇召回。
- S3：若相似度高于阈值 `T_sim`，写入目标簇；否则新建簇。
- S4：对簇执行结构化融合，得到共识参数集合。
- S5：检测同槽位多值情形，生成冲突记录。
- S6：读取偏好向量 `P`，确定保留强度与摘要预算。
- S7：生成簇摘要并保存 backrefs 索引。
- S8：检索时先返回摘要，再按 backrefs 展开证据。

## 三、关键约束
- 冲突信息必须显式记录，不得直接覆盖旧值。
- 每个簇摘要必须至少对应一个 backrefs 集合。
- 偏好配置可更新，但更新应版本化并可追踪。
