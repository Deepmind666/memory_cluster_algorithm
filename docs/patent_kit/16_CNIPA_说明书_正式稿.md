# 16 CNIPA 说明书正式稿

## 发明名称
多智能体协同下的语义记忆碎片聚类压缩与冲突治理方法、系统、装置及存储介质

## 技术领域
[0001] 本发明涉及人工智能与数据处理技术领域，尤其涉及一种面向多智能体协同场景的语义记忆碎片聚类压缩与冲突治理方法、系统、装置及计算机可读存储介质。

## 背景技术
[0002] 在多智能体协同任务中，规划智能体、写作智能体、验证智能体等会持续写入中间结论、参数建议、工具输出和执行日志，形成共享记忆池。

[0003] 随着任务轮次增加，共享记忆池易出现冗余增长、同槽位多值冲突、上下文注入膨胀以及证据链断裂等问题。

[0004] 现有技术中，US20110238408A1公开了语义聚类相关方案，能够对语义近似内容进行聚合，但未针对多智能体共享写入后的冲突显式治理提供完整机制。

[0005] US12008332B1公开了偏好驱动的摘要控制思路，但主要侧重摘要输出层，对冲突证据的结构化建模和跨步骤治理链路支持不足。

[0006] US20240289863A1公开了共享向量记忆相关方案，重点在共享访问与检索效率，未充分解决同槽位冲突值的可计算治理与审计回溯问题。

[0007] 非专利实现方面，LangChain ConversationSummaryBufferMemory采用滚动摘要策略，MemGPT（Packer 等，2023）采用分层记忆管理策略，均未同时覆盖“冲突证据图 + 双通道门控 + 自适应预算 + 可逆回溯”闭环。

[0008] 特别地，现有方案常将冲突值覆盖为单一结果，导致冲突来源不可追溯；同时，固定预算摘要难以在高冲突区域保留足够证据细节。

[0009] 此外，仅以语义相似度驱动簇合并，可能将语义接近但事实冲突的簇错误合并，造成后续推理一致性下降。

[0010] 因此，亟需一种兼顾压缩效率、冲突治理与审计可追溯性的技术方案。

## 发明内容

### 一、发明目的
[0011] 本发明的目的在于提供一种多智能体协同记忆治理方案，以解决共享记忆池中的冗余扩张、冲突隐式覆盖、预算分配粗粒度和证据不可逆回溯问题。

[0012] 本发明进一步提供对应的系统、装置和计算机可读存储介质，以支持工程化部署。

### 二、技术方案
[0013] 为实现上述目的，本发明提供一种多智能体协同记忆压缩与冲突治理方法，包括如下步骤：

[0014] S1，接收多个智能体写入的记忆碎片并标准化，所述记忆碎片至少包括内容字段和来源标识。

[0015] S2，对所述记忆碎片进行语义向量化并执行增量聚类，得到语义簇集合。

[0016] S3，在簇内检测同槽位多值冲突并构建冲突证据图。

[0017] S4，基于冲突密度分配簇级自适应保留预算；在优选实施方式中，预算还与来源分布熵和时效衰减相关。

[0018] S5，在簇合并阶段同时执行语义相似度通道与冲突兼容通道判定，仅当两个通道均满足阈值约束时允许合并。

[0019] S6，生成簇摘要并保存可逆回溯索引 backrefs，使检索阶段可由摘要按需展开到原始证据碎片。

[0020] 在可选实施方式中，方法还包括：条件作用域隔离、反事实作用域隔离、否定窗口识别与跨句代词回指解析，以提升冲突语义抽取精度。

[0021] 在可选实施方式中，方法还可包括合并上界剪枝、签名桶候选筛选和多表近似候选检索，以减少候选比较开销；在一个优选实施方式中，所述核心步骤可进一步细化为S1-S8子步骤流程，对应图2所示。

### 三、术语定义与示例公式
[0022] 本发明所称“冲突证据图（Conflict Evidence Graph）”，是指以冲突值为节点、以值切换事件为有向边、并在节点上附加证据计数的有向图数据结构。

[0023] 本发明所称“双通道门控”，是指语义相似度通道和冲突兼容通道共同参与合并判定，采用逻辑“与”关系输出最终合并决策。

[0024] 本发明所称“冲突兼容度”，是指两个候选簇在结构化槽位值层面的兼容程度，优选以槽位值集合的交并比表示。

[0025] 在一个示例实施方式中，冲突优先级可按下式计算：  
P_conf = alpha * V + beta * S + gamma * E  
其中，V为冲突值数量，S为值切换次数，E为证据数量，alpha、beta、gamma为可配置权重。

[0026] 在一个示例实施方式中，簇级预算可按下式计算：  
B = clamp(B_min, B_max, B0 * (1 + lambda1 * D + lambda2 * H - lambda3 * R))  
其中，D为冲突密度，H为来源分布熵，R为时效衰减项。

[0027] 在一个示例实施方式中，冲突兼容度可按下式计算：  
Compat(i,j) = |S_i ∩ S_j| / |S_i ∪ S_j|  
其中，S_i、S_j分别为两个候选簇的槽位值集合；当Compat(i,j)=0时阻断合并。

### 四、有益效果
[0028] 与现有技术相比，本发明至少具有以下有益效果：

[0029] 第一，通过冲突证据图将冲突从隐式覆盖转变为结构化可计算对象，提升冲突可解释性与可审计性。

[0030] 第二，通过自适应预算策略将高冲突高价值簇分配更多细节预算，在固定容量约束下提高关键信息保真度。

[0031] 第三，通过双通道合并门控降低语义近似但事实冲突簇的误合并概率，提高跨智能体记忆一致性。

[0032] 第四，通过作用域隔离、否定识别和跨句回指联合抽取机制降低冲突语义误报漏报。

[0033] 第五，通过 backrefs 建立摘要到原始证据的可逆路径，增强后续追溯和审计能力。

## 附图说明
[0034] 图1为本发明系统总体架构示意图。

[0035] 图2为本发明方法流程示意图。

[0036] 图3为本发明记忆碎片、语义簇、冲突记录、偏好策略和回溯索引的数据关系示意图。

[0037] 图4为本发明冲突证据图构建与冲突优先级计算示意图。

[0038] 图5为本发明双通道合并门控判定示意图。

[0039] 图6为本发明检索与按需证据回溯流程示意图。

## 具体实施方式
[0040] 为使本领域技术人员更好理解本发明，以下结合附图与实施例对本发明进行进一步说明。应当理解，下述实施例仅用于说明本发明，而非用于限定本发明保护范围。

### 实施例一：半真实数据集下的核心链路定量验证（realistic）
[0041] 在本实施例中，系统接收来自多个智能体的2000条记忆碎片，阈值设置为similarity_threshold=0.68、merge_threshold=0.82，执行12轮重复实验（warmup=2）。

[0042] 基线场景中，cluster_count均值为10.0，conflict_priority_avg均值为0.0，detail_budget_avg均值为200.0。

[0043] 启用冲突证据图后，ceg_conflict_priority_gain均值为76.1；启用自适应预算后，arb_detail_budget_gain均值为76.9，均呈稳定正向增益。

[0044] 该实施例验证了在真实任务分布下，冲突优先级计算与预算分配机制具有可重复、可量化效果。

### 实施例二：高冲突压力场景下的门控验证（stress）
[0045] 在本实施例中，系统接收2000条高冲突记忆碎片，阈值设置为similarity_threshold=1.1、merge_threshold=0.05，执行12轮重复实验（warmup=2）。

[0046] 启用双通道门控后，dmg_merge_block_gain均值为12373.0，dmg_mixed_mode_reduction均值为1.0，表明门控有效阻断事实冲突合并。

[0047] 同时，ceg_conflict_priority_gain均值为698.8，arb_detail_budget_gain均值为4.0，验证冲突证据图与预算策略在压力场景仍保持正向作用。

### 实施例三：语义抽取增强流程
[0048] 在本实施例中，对包含条件句、反事实句和否定表达的记忆碎片，系统先执行作用域识别，再执行槽位提取。

[0049] 对于条件句，仅抽取后件有效语义；对于反事实表达，标记为条件分支语义；对于否定表达，执行否定窗口识别以保留极性信息；对于跨句代词表达，将中文代词和英文代词映射到最近有效槽位。

### 实施例四：可选加速实施方式
[0050] 在本实施例中，可在簇合并前执行相似度上界剪枝，当理论上界低于合并阈值时跳过精确比较。

[0051] 还可建立签名桶候选邻接关系，或采用多表近似候选检索，与上述剪枝联合使用，以进一步减少比较对数量。

[0052] 上述加速步骤作为可选实施方式，可与核心冲突治理链路解耦部署。

### 系统与装置实施方式
[0053] 本发明还提供一种系统或装置，包括处理器、存储器以及存储于存储器并可在处理器上运行的程序指令。

[0054] 所述程序指令被执行时，实现本说明书所述方法步骤。

[0055] 所述系统可划分为碎片采集模块、语义向量化模块、增量聚类模块、冲突证据图构建模块、自适应预算模块、双通道合并门控模块、语义抽取与回指解析模块、索引与检索模块。

### 其他说明
[0056] 本发明中的阈值、权重、预算限幅区间可根据任务域和数据分布配置，不限定具体数值。

[0057] 本发明中的存储实现可采用JSONL、关系数据库或键值存储，不构成对本发明保护范围的限制。

[0058] 本发明中的向量化实现可替换，不限定为特定模型或特定维度。

[0059] 在不脱离本发明精神和实质的前提下，本领域技术人员可对本发明作出各种修改或等同替换，均应落入本发明保护范围。
