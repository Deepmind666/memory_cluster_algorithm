# Next Phase Plan (R-005)

最后更新：2026-02-09

## 1. 当前状态总结
- 已完成核心闭环：采集 -> 向量化 -> 增量聚类 -> 压缩/冲突 -> 检索 -> 指标。
- 已实现评审重点项：语义去重、严格冲突分裂、检索分页与排序增强、L2 层次簇。
- 回归状态：`python -m unittest discover -s tests -p "test_*.py" -v` 为 11/11 通过。
- CLI 可运行：`ingest/build/query/eval` 与 `scripts/run_benchmark.py` 均可复现。

## 2. 未完成工作清单
1. 大规模簇性能优化（P1）
- 现状：簇合并为 O(k^2)，k 大时成本高。
- 目标：引入近似邻居策略（桶化/LSH/ANN）替代全量两两比较。
- 预估：3-5 天（含基准对比与回归）。

2. 冲突语义增强（P1）
- 现状：规则可识别 key-value 和基础否定，但复杂语义覆盖有限。
- 目标：补充复杂否定/反事实/条件句规则，并新增误报率测试。
- 预估：2-3 天。

3. 检索可解释性与评估闭环（P2）
- 现状：排序权重为启发式，缺少任务级校准。
- 目标：增加排序分项输出与离线样本评估脚本，支持调参。
- 预估：2-3 天。

4. 专利材料收敛（P2）
- 现状：草案已完整，但与最新 L2/检索增强尚未全部同步。
- 目标：统一术语、补实施例、补可量化技术效果。
- 预估：2 天。

## 3. 计划合理性评估
- 合理点：
  - 先性能（可运行规模）再语义（可用准确性）再材料（可申报一致性），依赖顺序正确。
  - 每个阶段都有可验证产物（测试、benchmark、文档更新），可审计。
- 不合理点（已修正）：
  - 过去阶段把“L2 未实现”和“检索增强未完成”并列在 backlog，但代码已落地；现已改为“已完成，继续优化”。
  - 评测口径曾被 L2 混入影响；现已改为 L1 主指标 + all 辅助指标。

## 4. 建议执行节奏（具体日期）
1. 2026-02-10 至 2026-02-12：性能阶段
- 完成近似簇合并原型与对照基准。
- 产出：性能报告、回归测试、可开关参数。

2. 2026-02-13 至 2026-02-14：语义冲突阶段
- 扩展冲突规则与边界用例测试。
- 产出：新增规则说明、误报/漏报样例表。

3. 2026-02-15 至 2026-02-16：检索评估阶段
- 增加排序可解释输出和小规模标注集评估脚本。
- 产出：权重建议、评估结果快照。

4. 2026-02-17：专利材料收口
- 同步最新实现到 `docs/patent_kit/` 与 `docs/FINAL_REPORT.md`。
- 产出：可交付代理人评阅的统一包。

## 5. 风险与缓解
- 风险：ANN 引入后可解释性下降。
- 缓解：保留 `--exact-merge` 回退开关并在 benchmark 中并行输出两套结果。

- 风险：规则扩展导致误报。
- 缓解：将新规则逐条配套反例单测并设置白名单覆盖。

- 风险：文档与代码再次漂移。
- 缓解：提交前强制执行 `docs/REVIEW_CHECKLIST.md` + `WORK_PROGRESS.md` 更新。

## 6. 非法律声明
本计划用于工程执行，不构成法律意见。正式专利申请文本需由专利代理人复核。
