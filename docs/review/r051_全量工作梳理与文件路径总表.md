# R-051 全量工作梳理与文件路径总表

## 1. 项目目标与当前状态
本项目目标是构建单机可运行的多智能体记忆压缩与冲突治理原型，形成“可运行代码 + 可复现实验 + 可审计证据 + CNIPA 专利材料”的完整闭环。

当前状态：
- 代码主链路可运行，核心模块稳定。
- 测试通过：`108/108`。
- Stage-2 门禁通过：`passed=true`、`check_count=14`、`blocker_failures=0`。
- 证据包校验通过：`validation.passed=true`。
- CNIPA 正式材料（16-21）与 v2 附图已形成可提交前版本。

## 2. 核心代码工作内容与路径
### 2.1 入口与流程编排
- `src/memory_cluster/__main__.py`
- `src/memory_cluster/cli.py`
- `src/memory_cluster/pipeline.py`

### 2.2 数据模型与时间工具
- `src/memory_cluster/models.py`
- `src/memory_cluster/time_utils.py`

### 2.3 算法核心（聚类/冲突/压缩/偏好/检索）
- `src/memory_cluster/cluster.py`
- `src/memory_cluster/compress.py`
- `src/memory_cluster/preference.py`
- `src/memory_cluster/retrieve.py`
- `src/memory_cluster/embed.py`
- `src/memory_cluster/store.py`
- `src/memory_cluster/eval.py`
- `src/memory_cluster/__init__.py`

## 3. 实验与工程脚本路径
### 3.1 核心实验与消融
- `scripts/run_ablation.py`
- `scripts/run_core_scaling_benchmark.py`
- `scripts/run_core_ablation_on_dataset.py`
- `scripts/run_core_claim_stability.py`
- `scripts/generate_semi_real_dataset.py`

### 3.2 候选筛选/ANN/剪枝专项
- `scripts/run_candidate_filter_benchmark.py`
- `scripts/run_candidate_profile_validation.py`
- `scripts/run_ann_hybrid_benchmark.py`
- `scripts/run_prune_benchmark.py`
- `scripts/run_stage3_param_sweep.py`

### 3.3 语义精度与门禁
- `scripts/run_semantic_regression.py`
- `scripts/run_stage2_guardrail.py`
- `scripts/build_patent_evidence_pack.py`
- `scripts/check_stage2_gate_for_sha.py`
- `scripts/check_ci_output_isolation.py`
- `scripts/run_ci_guardrail_bundle.py`
- `scripts/update_guardrail_trend.py`

### 3.4 辅助维护
- `scripts/append_progress.ps1`
- `scripts/append_review_closure_round.py`

## 4. 测试体系路径
### 4.1 功能与算法测试
- `tests/test_clustering_basic.py`
- `tests/test_conflict_graph_and_budget.py`
- `tests/test_conflict_marking.py`
- `tests/test_conflict_semantics.py`
- `tests/test_dual_merge_guard.py`
- `tests/test_merge_candidate_filter.py`
- `tests/test_merge_ann_candidates.py`
- `tests/test_merge_upper_bound_prune.py`
- `tests/test_preference_policy.py`
- `tests/test_semantic_precision_regression.py`
- `tests/test_semantic_dedup.py`
- `tests/test_retrieve_ordering.py`
- `tests/test_protected_preferences.py`
- `tests/test_l2_hierarchy.py`
- `tests/test_edge_cases.py`

### 4.2 存储/工具/稳定性测试
- `tests/test_store_roundtrip.py`
- `tests/test_store_reliability.py`
- `tests/test_time_utils.py`
- `tests/test_embed_eval_unit.py`
- `tests/test_core_claim_stability_unit.py`
- `tests/test_core_claim_stability_resume_smoke.py`

### 4.3 门禁/CI/治理测试
- `tests/test_stage2_guardrail.py`
- `tests/test_stage2_guardrail_cli_smoke.py`
- `tests/test_ci_guardrail_bundle_unit.py`
- `tests/test_ci_output_isolation_unit.py`
- `tests/test_check_stage2_gate_for_sha_unit.py`
- `tests/test_guardrail_trend_unit.py`
- `tests/test_review_closure_matrix_unit.py`

## 5. 评测报告与证据路径
### 5.1 报告文档（docs/eval）
- `docs/eval/ablation_report_cn.md`
- `docs/eval/ablation_report_large_cn.md`
- `docs/eval/ablation_report_stress_cn.md`
- `docs/eval/core_scaling_realistic_report.md`
- `docs/eval/core_scaling_stress_report.md`
- `docs/eval/core_ablation_semi_real_2000_realistic_report.md`
- `docs/eval/core_ablation_semi_real_2000_stress_report.md`
- `docs/eval/core_ablation_semi_real_5000_realistic_report.md`
- `docs/eval/core_ablation_semi_real_5000_stress_report.md`
- `docs/eval/core_ablation_semi_real_5000_stress_runs2_report.md`
- `docs/eval/core_claim_stability_semi_real_2000_realistic_report.md`
- `docs/eval/core_claim_stability_semi_real_2000_stress_report.md`
- `docs/eval/core_claim_stability_semi_real_5000_realistic_report.md`
- `docs/eval/core_claim_stability_semi_real_5000_stress_report.md`
- `docs/eval/candidate_filter_benchmark_report.md`
- `docs/eval/candidate_profile_validation_summary.md`
- `docs/eval/candidate_profile_validation_synthetic_active_report.md`
- `docs/eval/candidate_profile_validation_realistic_report.md`
- `docs/eval/candidate_profile_validation_stress_report.md`
- `docs/eval/ann_hybrid_benchmark_report.md`
- `docs/eval/prune_benchmark_report.md`
- `docs/eval/semantic_regression_report.md`
- `docs/eval/stage2_guardrail_report.md`
- `docs/eval/stage3_param_sweep_report.md`
- `docs/eval/demo_walkthrough.md`
- `docs/eval/ablation_explained_cn.md`

### 5.2 关键输出（outputs）
- `outputs/ablation_metrics*.json`
- `outputs/core_scaling_*.json`
- `outputs/core_ablation_*.json`
- `outputs/core_claim_stability_*.json`
- `outputs/candidate_filter_benchmark.json`
- `outputs/candidate_profile_validation_*.json`
- `outputs/ann_hybrid_benchmark.json`
- `outputs/prune_benchmark.json`
- `outputs/semantic_regression_metrics.json`
- `outputs/stage2_guardrail.json`
- `outputs/patent_evidence_pack.json`

## 6. 专利材料路径（docs/patent_kit）
### 6.1 交底与技术文档（00-15）
- `docs/patent_kit/00_技术交底书_总览.md`
- `docs/patent_kit/01_背景技术.md`
- `docs/patent_kit/02_发明内容_技术问题与效果.md`
- `docs/patent_kit/03_技术方案_系统与流程.md`
- `docs/patent_kit/04_附图说明.md`
- `docs/patent_kit/05_具体实施方式.md`
- `docs/patent_kit/06_权利要求书_草案.md`
- `docs/patent_kit/07_摘要.md`
- `docs/patent_kit/08_对比文件与绕开说明.md`
- `docs/patent_kit/09_授权潜力评估与下一步建议.md`
- `docs/patent_kit/10_区别特征_技术效果_实验映射.md`
- `docs/patent_kit/11_主张_证据_命令对照.md`
- `docs/patent_kit/12_代理人交接包_一页纸.md`
- `docs/patent_kit/13_代理人交接包_权利要求策略说明.md`
- `docs/patent_kit/14_代理人交接包_证据索引与提交流程.md`
- `docs/patent_kit/15_代理人沟通邮件模板.md`

### 6.2 CNIPA 正式材料（16-21）
- `docs/patent_kit/16_CNIPA_说明书_正式稿.md`
- `docs/patent_kit/17_CNIPA_权利要求书_正式稿.md`
- `docs/patent_kit/18_CNIPA_说明书摘要_正式稿.md`
- `docs/patent_kit/19_CNIPA_附图文字描述稿.md`
- `docs/patent_kit/20_CNIPA_附图清单_预览.md`
- `docs/patent_kit/21_师兄评审前_改进建议与变更说明.md`

### 6.3 附图文件
v2（当前提交候选）：
- `docs/patent_kit/figures/fig1_v2_system_architecture.svg`
- `docs/patent_kit/figures/fig2_v2_method_flow.svg`
- `docs/patent_kit/figures/fig3_v2_data_structure.svg`
- `docs/patent_kit/figures/fig4_v2_conflict_evidence_graph.svg`
- `docs/patent_kit/figures/fig5_v2_dual_channel_gate.svg`
- `docs/patent_kit/figures/fig6_v2_retrieval_backref.svg`
- `docs/patent_kit/figures/fig_abs_v2_abstract.svg`

历史版（保留对照）：
- `docs/patent_kit/figures/fig1_system_architecture.svg`
- `docs/patent_kit/figures/fig2_method_flow_s1_s8.svg`
- `docs/patent_kit/figures/fig3_data_structure_relationship.svg`
- `docs/patent_kit/figures/fig4_conflict_evidence_graph.svg`
- `docs/patent_kit/figures/fig5_dual_channel_merge_gate.svg`
- `docs/patent_kit/figures/fig6_retrieval_backref_flow.svg`
- `docs/patent_kit/figures/fig_abs_abstract_figure.svg`

## 7. 治理、评审与进度路径
- `.claude.md`
- `WORK_PROGRESS.md`
- `docs/FINAL_REPORT.md`
- `docs/review/`（各轮评审报告）

## 8. 本轮关键修复（R-049/R-050）
### 8.1 附图与文档合规修复
- 图1输出框重叠修复：`docs/patent_kit/figures/fig1_v2_system_architecture.svg`
- 图4补齐三节点到优先级虚线：`docs/patent_kit/figures/fig4_v2_conflict_evidence_graph.svg`
- 图4标题统一为“冲突优先级计算”：`docs/patent_kit/figures/fig4_v2_conflict_evidence_graph.svg`
- 图5收紧空白：`docs/patent_kit/figures/fig5_v2_dual_channel_gate.svg`
- 图6收紧空白：`docs/patent_kit/figures/fig6_v2_retrieval_backref.svg`
- 标号 500 补充：`docs/patent_kit/19_CNIPA_附图文字描述稿.md`
- 图1版式描述改正：`docs/patent_kit/19_CNIPA_附图文字描述稿.md`
- 摘要附图口径统一：`docs/patent_kit/18_CNIPA_说明书摘要_正式稿.md`、`docs/patent_kit/19_CNIPA_附图文字描述稿.md`

### 8.2 同步更新
- 进度记录：`WORK_PROGRESS.md`
- 评审记录：`.claude.md`
- 引用同步：`docs/FINAL_REPORT.md`、`docs/patent_kit/20_CNIPA_附图清单_预览.md`、`docs/patent_kit/21_师兄评审前_改进建议与变更说明.md`

## 9. 当前提交前建议
1. 使用 v2 附图作为后续正式导出源文件。
2. 保留历史版图件仅作追溯，不再作为提交候选。
3. 在提交 CPC 前，按 v2 附图统一导出 PDF/TIFF 一次性封版。
